<div class="home-container">
    <!-- Animated Stars Background -->
    <div class="stars-container">
        <div class="stars stars-1"></div>
        <div class="stars stars-2"></div>
        <div class="stars stars-3"></div>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Initializing systems...</p>
    </div>
    } @else {

    <!-- GUEST VIEW -->
    @if (!isLoggedIn()) {
    <div class="guest-view">
        <!-- Left Panel: Hero + Recent Missions -->
        <div class="left-panel">
            <div class="hero-section">
                <div class="hero-content">
                    <h1 class="hero-title">The<span class="accent">MissionDoor</span></h1>
                    <p class="hero-subtitle">Join the elite force of brawlers and embark on high-stakes missions across
                        the
                        multiverse.</p>
                    <button mat-flat-button class="cta-button" (click)="goToLogin()">
                        <mat-icon>rocket_launch</mat-icon>
                        Start Your Journey
                    </button>
                </div>
            </div>

            <!-- Recent Missions Section -->
            @if (recentMissions().length > 0) {
            <div class="recent-missions-section">
                <div class="section-title-row">
                    <h2 class="section-title">Recent Missions</h2>
                    <button mat-stroked-button class="view-all-btn view-all-btn-sm" (click)="goToLogin()">
                        View All Missions
                        <mat-icon>arrow_forward</mat-icon>
                    </button>
                </div>
                <div class="missions-list">
                    @for (mission of recentMissions(); track mission.id) {
                    <div class="mission-card glass-panel">
                        <div class="mission-header">
                            <span class="mission-name">{{ mission.name }}</span>
                            <span class="status-badge" [class]="mission.status.toLowerCase()">
                                {{ mission.status }}
                            </span>
                        </div>
                        <p class="mission-description">{{ mission.description || 'No description' }}</p>
                        <div class="mission-meta">
                            <span><mat-icon>person</mat-icon> {{ mission.chief_display_name }}</span>
                            <span><mat-icon>group</mat-icon> {{ mission.crew_count }}/3</span>
                            <span><mat-icon>schedule</mat-icon> {{ mission.created_at | date:'short' }}</span>
                        </div>
                    </div>
                    }
                </div>
            </div>
            }
        </div>

        <!-- Right Panel: 3D Earth Globe -->
        <div class="right-panel">
            <div class="globe-container">
                <div class="globe-glow"></div>
                <div class="globe">
                    <div class="globe-inner"></div>
                </div>
                <div class="orbit-ring orbit-ring-1"></div>
                <div class="orbit-ring orbit-ring-2"></div>

                <!-- Floating Profile Avatars with Connector Lines -->
                <svg class="connector-lines" viewBox="0 0 520 520">
                    <line class="connector-line" x1="260" y1="260" x2="80" y2="60" />
                    <line class="connector-line" x1="260" y1="260" x2="450" y2="90" />
                    <line class="connector-line" x1="260" y1="260" x2="470" y2="400" />
                    <line class="connector-line" x1="260" y1="260" x2="50" y2="420" />
                    <line class="connector-line" x1="260" y1="260" x2="130" y2="240" />
                </svg>

                <div class="float-avatar avatar-1">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-2">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-3">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-4">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-5">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- AUTHENTICATED VIEW -->
    @if (isLoggedIn()) {
    <div class="authenticated-view">
        <!-- Left Panel: Welcome + Stats -->
        <div class="left-panel">
            <div class="welcome-header">
                <h1 class="welcome-title">Welcome back, <span class="accent">{{ displayName() }}</span>!</h1>
                <p class="welcome-subtitle">Here's your mission status overview</p>
                <div class="divider-line"></div>
            </div>

            <!-- User Stats Panel -->
            @if (userDashboard()) {
            <div class="user-stats-section">
                <div class="stats-grid user-stats">
                    <div class="stat-card glass-panel highlight" style="animation-delay: 0.1s;">
                        <div class="stat-icon owned-icon">
                            <mat-icon>military_tech</mat-icon>
                        </div>
                        <div class="stat-value">{{ userDashboard()?.stats?.my_missions_count }}</div>
                        <div class="stat-label">Leading</div>
                    </div>
                    <div class="stat-card glass-panel" style="animation-delay: 0.2s;">
                        <div class="stat-icon joined-icon">
                            <mat-icon>handshake</mat-icon>
                        </div>
                        <div class="stat-value">{{ userDashboard()?.stats?.joined_missions_count }}</div>
                        <div class="stat-label">Joined</div>
                    </div>
                    <div class="stat-card glass-panel" style="animation-delay: 0.3s;">
                        <div class="stat-icon success-icon">
                            <mat-icon>emoji_events</mat-icon>
                        </div>
                        <div class="stat-value">{{ userDashboard()?.stats?.success_count }}</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card glass-panel" style="animation-delay: 0.4s;">
                        <div class="stat-icon rate-icon">
                            <mat-icon>trending_up</mat-icon>
                        </div>
                        <div class="stat-value">{{ successRate() }}%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
            </div>
            }
        </div>

        <!-- Right Panel: 3D Earth Globe -->
        <div class="right-panel">
            <div class="globe-container">
                <div class="globe-glow"></div>
                <div class="globe">
                    <div class="globe-inner"></div>
                </div>
                <div class="orbit-ring orbit-ring-1"></div>
                <div class="orbit-ring orbit-ring-2"></div>

                <!-- Floating Profile Avatars with Connector Lines -->
                <svg class="connector-lines" viewBox="0 0 520 520">
                    <line class="connector-line" x1="260" y1="260" x2="80" y2="60" />
                    <line class="connector-line" x1="260" y1="260" x2="450" y2="90" />
                    <line class="connector-line" x1="260" y1="260" x2="470" y2="400" />
                    <line class="connector-line" x1="260" y1="260" x2="50" y2="420" />
                    <line class="connector-line" x1="260" y1="260" x2="130" y2="240" />
                </svg>

                <div class="float-avatar avatar-1">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-2">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-3">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-4">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
                <div class="float-avatar avatar-5">
                    <div class="avatar-ring">
                        <mat-icon>person</mat-icon>
                    </div>
                </div>
            </div>
        </div>
    </div>
    }
    }
</div>