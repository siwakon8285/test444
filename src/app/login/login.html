<div class="login-container">
    <!-- Background Decor -->
    <div class="glow-bg"></div>

    <mat-card class="glass-panel login-card">
        <div class="card-header">
            <div class="icon-badge">
                <mat-icon>{{ mode === 'login' ? 'lock_open' : 'person_add' }}</mat-icon>
            </div>
            <h3>{{ mode === 'login' ? 'Welcome Back' : 'Create Account' }}</h3>
            <p>{{ mode === 'login' ? 'Enter your credentials to access your account' : 'Join us and start your journey
                today' }}</p>
        </div>

        <form (ngSubmit)="onSubmit()" [formGroup]="form" autocomplete="off">
            <!-- Username -->
            <mat-form-field appearance="outline" class="custom-field">
                <mat-label>Username</mat-label>
                <mat-icon matPrefix>person</mat-icon>
                <input matInput type="text" placeholder="username" formControlName="username"
                    (input)="updateErrorMessage('username')">
                @if (form.controls['username'].invalid) {
                <mat-error>{{errorMessage.username()}}</mat-error>
                }
            </mat-form-field>

            <!-- Password -->
            <mat-form-field appearance="outline" class="custom-field">
                <mat-label>Password</mat-label>
                <mat-icon matPrefix>key</mat-icon>
                <input matInput type="password" placeholder="password" formControlName="password"
                    (input)="updateErrorMessage('password')">
                @if (form.controls['password'].invalid) {
                <mat-error>{{errorMessage.password()}}</mat-error>
                }
            </mat-form-field>

            @if (mode === 'register') {
            <!-- Confirm Password -->
            <mat-form-field appearance="outline" class="custom-field">
                <mat-label>Confirm Password</mat-label>
                <mat-icon matPrefix>lock_reset</mat-icon>
                <input matInput type="password" placeholder="confirm password" formControlName="confirm_password"
                    (input)="updateErrorMessage('confirm_password')">
                @if (form.controls['confirm_password'].invalid) {
                <mat-error>{{errorMessage.confirm_password()}}</mat-error>
                }
            </mat-form-field>

            <!-- Display Name -->
            <mat-form-field appearance="outline" class="custom-field">
                <mat-label>Display Name</mat-label>
                <mat-icon matPrefix>badge</mat-icon>
                <input matInput type="text" placeholder="display name" formControlName="display_name"
                    (input)="updateErrorMessage('display_name')">
                @if (form.controls['display_name'].invalid) {
                <mat-error>{{errorMessage.display_name()}}</mat-error>
                }
            </mat-form-field>
            }

            <button mat-raised-button type="submit" class="submit-btn" [disabled]="!form.valid">
                {{ mode === 'login' ? 'Sign In' : 'Sign Up' }}
                <mat-icon>arrow_forward</mat-icon>
            </button>
        </form>

        @if(errorFromServer !== '') {
        <div class="error-banner">
            <mat-icon>error_outline</mat-icon>
            <span>{{errorFromServer}}</span>
        </div>
        }




        <div class="toggle-wrapper">
            @if (mode === 'login') {
            <p>Don't have an account? <span (click)="toggleMode()">Sign up now</span></p>
            } @else {
            <p>Already have an account? <span (click)="toggleMode()">Log in</span></p>
            }
        </div>
    </mat-card>
</div>